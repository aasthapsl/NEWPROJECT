customElements.get("product-form")||customElements.define("product-form",class extends HTMLElement{constructor(){super(),this.form=this.querySelector("form"),this.form.querySelector("[name=id]").disabled=!1,this.form.addEventListener("submit",this.onSubmitHandler.bind(this)),this.cartNotification=document.querySelector("cart-notification"),this.submitButton=this.querySelector('[type="submit"]')}onSubmitHandler(e){if(e.preventDefault(),"true"!==this.submitButton.getAttribute("aria-disabled")){this.handleErrorMessage(),this.cartNotification.setActiveElement(document.activeElement),this.submitButton.setAttribute("aria-disabled",!0),this.submitButton.classList.add("loading"),this.querySelector(".loading-overlay__spinner").classList.remove("hidden");const t=fetchConfig("javascript"),s=(t.headers["X-Requested-With"]="XMLHttpRequest",delete t.headers["Content-Type"],new FormData(this.form));s.append("sections",this.cartNotification.getSectionsToRender().map(e=>e.id)),s.append("sections_url",window.location.pathname),t.body=s,fetch(""+routes.cart_add_url,t).then(e=>e.json()).then(e=>{if(e.status){this.handleErrorMessage(e.description);const t=this.submitButton.querySelector(".sold-out-message");void(t&&(this.submitButton.setAttribute("aria-disabled",!0),this.submitButton.querySelector("span").classList.add("hidden"),t.classList.remove("hidden"),this.error=!0))}else{this.error=!1;const s=this.closest("quick-add-modal");s?(document.body.addEventListener("modalClosed",()=>{setTimeout(()=>{this.cartNotification.renderContents(e)})},{once:!0}),s.hide(!0)):this.cartNotification.renderContents(e)}}).catch(e=>{console.error(e)}).finally(()=>{this.submitButton.classList.remove("loading"),this.error||this.submitButton.removeAttribute("aria-disabled"),this.querySelector(".loading-overlay__spinner").classList.add("hidden")})}}handleErrorMessage(e=!1){this.errorMessageWrapper=this.errorMessageWrapper||this.querySelector(".product-form__error-message-wrapper"),this.errorMessageWrapper&&(this.errorMessage=this.errorMessage||this.errorMessageWrapper.querySelector(".product-form__error-message"),this.errorMessageWrapper.toggleAttribute("hidden",!e),e&&(this.errorMessage.textContent=e))}});